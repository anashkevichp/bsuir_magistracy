\section{Background}

\subsection{Что такое RCU?}

Read-copy update (RCU) --- это механизм синхронизации,
часто используемый взамен блокировок чтения-записи.
RCU позволяет потокам-читателям выполняться одновременно
с потоками-писателями, избегая использования блокировок
чтения за счет управления жизненными циклами
множества версий целевого объекта.
В частности, данный механизм следит, чтобы объект,
к которому обращается поток-читатель,
не был удален в течение некоторого периода
после его изменения потоком-писателем.
Суть метода состоит в том, чтобы разделить процесс обновления
объекта на фазу удаления и освобождения, между которыми находится
некоторый промежуток времени --- \emph{grace-период}~\cite{McKenneyRCU98}.
В ходе фазы удаления выполнятеся удаление ссылок на объекты,
доступных для потоков-читателей, сопровождающееся, возможно,
заменой их новыми версиями.

Современные процессоры гарантируют, что операции чтения
одиночных выравненных указателей являются атомарными,
поэтому потоки-читатели могут получить доступ исключительно
к старой либо новой версии объекта чтения.
Atomic-write semantics позволяет выполнять атомарные вставки,
удаления и замены в связанных структурах данных.
Это, в свою очередь, позволяет потокам-читателям отказаться
от использования <<дорогих>> атомарных операций,
избавиться от барьеров памяти и связанных с ними промахов кэша.
Действительно, в наиболее оптимизированных конфигурациях Linux RCU,
потоки-читатели могут выполнять точно такую же последовательность
инструкций, какая использовалась бы в их однопоточной реализации,
что обеспечивает их отличную производительность и масштабируемость.

Как показано на рисунке~\ref{fig:rcu_concepts}, \emph{grace}-периоды
в действительности нужны только тем потокам-читателям,
у которыз момент чтения накладывается на фазу удаления.
Те из них, которые выполняются после удаления, не могут удерживать ссылки
на удаленные объекты и поэтому не могут быть заблокированы
в ходе фазы освобождения.

\begin{figure}[tbp]
\centering
\includegraphics[scale=0.35]{rcu_concepts.pdf}
\caption{Поведение RCU}
\label{fig:rcu_concepts}
\end{figure}

\input{api_usage.tex}
